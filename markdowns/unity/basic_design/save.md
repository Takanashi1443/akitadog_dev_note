# セーブ・ロード

## 用語

本内容はセーブ・ロードに関するものだが、クラス名などとしては単にSaveを使用する。
まず、この方法で作成するセーブ・ロードの仕組みにおいて以下の用語を限定使用する。

`SaveOrganizer`

:   セーブデータファイルを読み書きし、SaveOperatorに受け渡す権限を持ったクラス。
    XxxxSaveOrganizerなどのクラス名で使用する。

`SaveOperator`

:   SaveOrganizerからセーブデータの元となる情報（基本的にJSONなどの文字列）を受け取り、参照可能な形に変換するクラス。
    XxxxSaveOperatorなどのクラス名で使用する。
    自身のセーブデータの整合性を維持する役割を持つ。GameObjectたちはセーブデータに直接アクセスせず、このスクリプトを介してデータを取得・更新する。

`SaveItem`

:   SaveOperatorが取り扱う、セーブデータを具体的に格納するクラス。
    XxxxSaveItemなどのクラス名で使用する。

## 要件・設計（基本編）

この仕組みは、下記のような要件を実現できるように設計される。

### 1つのセーブデータには、様々な種類のデータが格納されている（それぞれをセクションと呼ぶ）。

- 1つのセクションに含まれるのは、単一の種類のデータとする。
- 1つのセクションに含まれるデータは、1つのみ保持される場合もあれば、配列、リスト、辞書などの形で複数保持される場合もある。

## 標準的に使用するモジュール・アセット

### NewtonsoftのJson.NET

汎用的にJSONを取り扱うために使用する。

この仕組みのポイントは、JSON.NETで柔軟にJSON文字列を取り扱いつつ（分解・取り纏めしつつ）、JsonUtilityのデシリアライズ機能でセーブデータを保持するクラスなど（SaveItem）に変換することである。

### EasySave3（オプション）

主にデータを暗号化するために使用する。

## 実装（基本編）


## なぜ上記のモジュール・アセットを使う必要があるか

UnityでJSONというとJsonUtilityというクラスがある。これはJSON形式の文字列から、シリアライズ可能に設計したクラスなどを作成（デシリアライズ）できる仕組みだが、あくまでJSON文字列から1つのクラスなどをデシリアライズするためのものであり、今回の要件のように、含まれるデータの種類が異なる複数のセクションを1つのJSON文字列にまとめるようなことは想定していない。また、デシリアライズがうまくいかなかった場合にそれを検知する仕組みがなく、不安全である。
C#でより汎用的にJSONを扱うライブラリとしてはSystem.Text.Jsonがあるが、型変換が難しいなど、柔軟に扱うことが難しい。

## 参考サイト

